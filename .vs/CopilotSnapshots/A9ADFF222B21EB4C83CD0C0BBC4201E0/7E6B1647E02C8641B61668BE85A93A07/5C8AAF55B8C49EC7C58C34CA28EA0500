@inherits LayoutComponentBase
@using DevPortal.Shared

<TopBar />

<div class="portal-container">
    <CascadingValue Value="this">
        @if (ShowWebAppSidebar && !string.IsNullOrEmpty(WebAppName))
        {
            <WebAppSidebar WebAppName="@WebAppName" WebAppId="@WebAppId" OnSectionChanged="OnSectionChanged" />
        }
        else
        {
            <Sidebar />
        }
        
        <div class="main-content">
            @Body
        </div>
    </CascadingValue>
</div>

@code {
    public bool ShowWebAppSidebar { get; private set; }
    public string WebAppName { get; private set; } = string.Empty;
    public string WebAppId { get; private set; } = string.Empty;
    public EventCallback<string> OnSectionChanged { get; private set; }

    public void SetWebAppContext(string webAppName, string webAppId, EventCallback<string> onSectionChanged)
    {
        ShowWebAppSidebar = true;
        WebAppName = webAppName;
        WebAppId = webAppId;
        OnSectionChanged = onSectionChanged;
        StateHasChanged();
    }

    public void ClearWebAppContext()
    {
        ShowWebAppSidebar = false;
        WebAppName = string.Empty;
        WebAppId = string.Empty;
        StateHasChanged();
    }
}
